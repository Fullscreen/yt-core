<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Yt::Request
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Yt/Request.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Yt.html" title="Yt (module)">Yt</a></span></span>
     &raquo; 
    <span class="title">Request</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Yt::Request
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Yt::Request</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/yt/request.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A wrapper around Net::HTTP to send HTTP requests to any web API and return
their result or raise an error if the result is unexpected. The basic way
to use Request is by calling <code>run</code> on an instance.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>List the most popular videos on YouTube.</p>
</div></p>
      
      <pre class="example code"><code>host = &#39;&#39;www.googleapis.com&#39;
path = &#39;/youtube/v3/videos&#39;
params = {chart: &#39;mostPopular&#39;, key: ENV[&#39;API_KEY&#39;], part: &#39;snippet&#39;}
response = Yt::Request.new(path: path, params: params).run
response.body[&#39;items&#39;].map{|video| video[&#39;snippet&#39;][&#39;title&#39;]}</code></pre>
    
  </div>


</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#as_curl-instance_method" title="#as_curl (instance method)">- (String) <strong>as_curl</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the <code>cURL</code> version of the request, useful to re-run the
request in a shell terminal.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Request) <strong>initialize</strong>(options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes a Request object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (Net::HTTPResponse) <strong>run</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends the request and returns the response.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Yt::Request (class)">Request</a></span></tt>) <strong>initialize</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initializes a Request object.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the options for the request.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:method</span>
          <span class="type">(<tt>String</tt>, <tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:get</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>The HTTP method to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:expected_response</span>
          <span class="type">(<tt>Class</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>Net::HTTPSuccess</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>The class of response that the request should obtain when run.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:response_format</span>
          <span class="type">(<tt>String</tt>, <tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:json</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>The expected format of the response body. If passed, the response body will
be parsed according to the format before being returned.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The host component of the request URI.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The path component of the request URI.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:params</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>The params to use as the query component of the request URI, for instance
the Hash <tt>{a: 1, b: 2}</tt> corresponds to the query parameters “a=1&amp;b=2”.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:camelize_params</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>true</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>whether to transform each key of params into a camel-case symbol before
sending the request.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:request_format</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:json</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>The format of the requesty body. If a request body is passed, it will be
parsed according to this format before sending it in the request.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:body</span>
          <span class="type">(<tt>#size</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The body component of the request.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:headers</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>The headers component of the request.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:auth</span>
          <span class="type">(<tt>#access_token</tt>, <tt>#refreshed_access_token?</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The authentication object. If set, must respond to
<code>access_token</code> and return the OAuth token to make an
authenticated request, and must respond to
<code>refreshed_access_token?</code> and return whether the access token
can be refreshed if expired.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yt/request.rb', line 51</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@method</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='symbol'>:method</span><span class='comma'>,</span> <span class='symbol'>:get</span>
  <span class='ivar'>@expected_response</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='symbol'>:expected_response</span><span class='comma'>,</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPSuccess</span>
  <span class='ivar'>@response_format</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='symbol'>:response_format</span><span class='comma'>,</span> <span class='symbol'>:json</span>
  <span class='ivar'>@host</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:host</span><span class='rbracket'>]</span>
  <span class='ivar'>@path</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span>
  <span class='ivar'>@params</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='symbol'>:params</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='comment'># Note: This is to be invoked by auth-only YouTube APIs.
</span>  <span class='ivar'>@params</span><span class='lbracket'>[</span><span class='symbol'>:key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:api_key</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:api_key</span><span class='rbracket'>]</span>
  <span class='comment'># Note: This is to be invoked by all YouTube API except Annotations,
</span>  <span class='comment'># Analyitics and Uploads
</span>  <span class='id identifier rubyid_camelize_keys!'>camelize_keys!</span> <span class='ivar'>@params</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:camelize_params</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='ivar'>@request_format</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='symbol'>:request_format</span><span class='comma'>,</span> <span class='symbol'>:json</span>
  <span class='ivar'>@body</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:body</span><span class='rbracket'>]</span>
  <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='symbol'>:headers</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@auth</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:auth</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="as_curl-instance_method">
  
    - (<tt>String</tt>) <strong>as_curl</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the <code>cURL</code> version of the request, useful to re-run the
request in a shell terminal.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the <code>cURL</code> version of the request.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91
92
93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yt/request.rb', line 89</span>

<span class='kw'>def</span> <span class='id identifier rubyid_as_curl'>as_curl</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>curl</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_curl'>curl</span><span class='op'>|</span>
    <span class='id identifier rubyid_curl'>curl</span> <span class='op'>&lt;&lt;</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> -X </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_http_request'>http_request</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_http_request'>http_request</span><span class='period'>.</span><span class='id identifier rubyid_each_header'>each_header</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_curl'>curl</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'> -H &quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_curl'>curl</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'> -d &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_http_request'>http_request</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>}</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_http_request'>http_request</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span>
    <span class='id identifier rubyid_curl'>curl</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'> &quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-instance_method">
  
    - (<tt>Net::HTTPResponse</tt>) <strong>run</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sends the request and returns the response. If the request fails once for a
temporary server error or an expired token, tries the request again before
eventually raising an error.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Net::HTTPResponse</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the request succeeds and matches the expectations, the response with the
body appropriately parsed.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Yt::RequestError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the request fails or the response does not match the expectations.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78
79
80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/yt/request.rb', line 76</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_matches_expectations?'>matches_expectations?</span>
    <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span><span class='lbrace'>{</span><span class='id identifier rubyid_parse_response!'>parse_response!</span><span class='rbrace'>}</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_run_again?'>run_again?</span>
    <span class='id identifier rubyid_run'>run</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_response_error'>response_error</span><span class='comma'>,</span> <span class='id identifier rubyid_error_message'>error_message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Apr 28 20:53:04 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.2).
</div>

  </body>
</html>